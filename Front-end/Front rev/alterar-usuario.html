<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Alterar Usuário</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Menu via JS -->
    <div id="menu-container"></div>

    <main>
        <div class="container">
            <h2>Alterar Usuário</h2>

            <form id="form-alterar-usuario">
                <label for="nomeUsuario">Nome do Usuário</label>
                <input type="text" id="nomeUsuario" name="nomeUsuario" required>

                <label for="emailUsuario">E-mail</label>
                <input type="email" id="emailUsuario" name="emailUsuario" required>

                <label for="perfilUsuario">Perfil</label>
                <select id="perfilUsuario" name="perfilUsuario" required>
                    <option value="Administrador">Administrador</option>
                    <option value="Gestor">Gestor</option>
                    <option value="Usuário">Usuário</option>
                </select>

                <label for="telefoneUsuario">Telefone</label>
                <input type="text" id="telefoneUsuario" name="telefoneUsuario">

                <div class="form-actions" style="text-align:center; margin-top:1rem;">
                    <button type="submit">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </main>

    <script src="menu.js" defer></script>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        // BACKEND: Carregar o menu e barra superior
        // O menu.js já faz isso, mas se precisar de dados do backend para o menu, inserir aqui.

        const urlParams = new URLSearchParams(window.location.search);
        const usuarioId = urlParams.get("id");

        if (usuarioId) {
            carregarDadosUsuario(usuarioId);
        } else {
            console.error("ID do usuário não fornecido na URL.");
            alert("ID do usuário não fornecido. Por favor, retorne à página de usuários.");
            // BACKEND: Opcional: redirecionar para a página de listagem de usuários
            // window.location.href = 'usuarios.html';
        }

        document.getElementById("form-alterar-usuario").addEventListener("submit", function(e){
            e.preventDefault();
            salvarAlteracoesUsuario(usuarioId);
        });
    });

    async function carregarDadosUsuario(id) {
        // BACKEND: Substituir esta simulação pela chamada à API para buscar os dados do usuário pelo ID
        try {
            // Exemplo de como seria a chamada real (assumindo uma API REST)
            // const response = await fetch(`/api/usuarios/${id}`);
            // if (!response.ok) throw new Error('Erro ao carregar usuário');
            // const usuario = await response.json();

            // Dados mock para demonstração
            const usuariosMock = [
                {id:"U001", nomeUsuario:"Admin Master", emailUsuario:"admin@teste.com", perfilUsuario:"Administrador", telefoneUsuario:"(27)99999-1111"},
                {id:"U002", nomeUsuario:"João Souza", emailUsuario:"joao@teste.com", perfilUsuario:"Usuário", telefoneUsuario:"(27)98888-2222"},
            ];
            const usuario = usuariosMock.find(u => u.id === id);

            if (usuario) {
                document.getElementById("nomeUsuario").value = usuario.nomeUsuario;
                document.getElementById("emailUsuario").value = usuario.emailUsuario;
                document.getElementById("perfilUsuario").value = usuario.perfilUsuario;
                document.getElementById("telefoneUsuario").value = usuario.telefoneUsuario;
            } else {
                console.error("Usuário não encontrado.");
                alert("Usuário não encontrado.");
                // BACKEND: Opcional: redirecionar para a página de listagem de usuários
                // window.location.href = 'usuarios.html';
            }
        } catch (error) {
            console.error("Erro ao carregar dados do usuário:", error);
            alert("Não foi possível carregar os dados do usuário.");
        }
    }

    async function salvarAlteracoesUsuario(id) {
        const nomeUsuario = document.getElementById("nomeUsuario").value;
        const emailUsuario = document.getElementById("emailUsuario").value;
        const perfilUsuario = document.getElementById("perfilUsuario").value;
        const telefoneUsuario = document.getElementById("telefoneUsuario").value;

        const dadosUsuarioAtualizados = {
            id: id,
            nomeUsuario: nomeUsuario,
            emailUsuario: emailUsuario,
            perfilUsuario: perfilUsuario,
            telefoneUsuario: telefoneUsuario
        };

        // BACKEND: Enviar dadosUsuarioAtualizados para a API de atualização do usuário
        try {
            // Exemplo de como seria a chamada real (assumindo uma API REST PUT/PATCH)
            // const response = await fetch(`/api/usuarios/${id}`, {
            //   method: 'PUT',
            //   headers: {
            //     'Content-Type': 'application/json'
            //   },
            //   body: JSON.stringify(dadosUsuarioAtualizados)
            // });

            // if (!response.ok) throw new Error('Erro ao salvar alterações do usuário');

            console.log('Dados do usuário atualizados:', dadosUsuarioAtualizados);
            alert('Usuário alterado com sucesso! (Simulado)');
            // BACKEND: Opcional: redirecionar para a página de listagem de usuários ou atualizar a página
            // window.location.href = 'usuarios.html';

        } catch (error) {
            console.error('Erro ao salvar alterações do usuário:', error);
            alert('Não foi possível salvar as alterações do usuário.');
        }
    }
    </script>
</body>
</html>

